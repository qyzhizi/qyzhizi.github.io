<!doctype html><html lang=zh-cn data-theme=dark><head><meta charset=utf-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: dark)"><meta name=generator content="Hugo 0.112.5"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="PyTorch DataLoader的工作机制"><meta itemprop=description content="PyTorch-DataLoader的工作机制"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="/imgs/2001_big_icons.png"><meta itemprop=keywords content="进程,pytorch,死锁"><meta property="og:type" content="article"><meta property="og:title" content="PyTorch DataLoader的工作机制"><meta property="og:description" content="PyTorch-DataLoader的工作机制"><meta property="og:image" content="/imgs/2001_big_icons.png"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="/pytorch-dataloader.html"><meta property="og:site_name" content="log"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="Hollis"><meta property="article:published_time" content="2023-06-23 20:53:31 +0800 CST"><meta property="article:modified_time" content="2023-06-23 20:53:31 +0800 CST"><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/font-awesome/6.1.2/css/all.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/animate.css/3.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.css><link rel=stylesheet href=/css/main.min.8b63813f6d971d6efc075de818d178312c142a542313b8ac1b773085bbc915ef.css><style type=text/css>.post-footer,.flinks-list-footer hr:after{content:"~ 我可是有底线的哟 ~"}</style><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":false,"isHome":false,"isPage":true,"path":"pytorch-dataloader.html","permalink":"/pytorch-dataloader.html","title":"PyTorch DataLoader的工作机制","waline":{"js":[{"alias":"waline","alias_name":"@waline/client","file":"dist/pageview.js","name":"pageview","version":"2.13.0"},{"alias":"waline","alias_name":"@waline/client","file":"dist/comment.js","name":"comment","version":"2.13.0"}]}}</script><title>PyTorch DataLoader的工作机制 - log</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label=切换导航栏 role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>log</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>programming</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about.html class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-flinks"><a href=/flinks.html class=hvr-icon-pulse rel=section><i class="fa fa-thumbs-up hvr-icon"></i>站点示例</a></li><li class="menu-item menu-item-archives"><a href=/archives/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>15</span></a></li><li class="menu-item menu-item-commonweal"><a href=/404.html class=hvr-icon-pulse rel=section><i class="fa fa-heartbeat hvr-icon"></i>公益 404</a></li><li class="menu-item menu-item-RSS"><a href=/rss.xml class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>RSS</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#datasetsampler-与-dataloader的关系>dataset、sampler 与 dataloader的关系？</a></li><li><a href=#dataloaderpy-主进程与工作进程的关系>dataloader.py 主进程与工作进程的关系？</a></li><li><a href=#数据时如何从迭代器dataloaderiter返回的>数据时如何从迭代器DataLoaderIter返回的？</a></li><li><a href=#dataloaderpy中主进程和工作进程是何时切换的会发生死锁吗>dataloader.py中主进程和工作进程是何时切换的？会发生死锁吗？</a></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=Hollis src=/imgs/img-lazy-loading.gif data-src=/imgs/2001_big_icons.png><p class=site-author-name itemprop=name>Hollis</p><div class=site-description itemprop=description>share something</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>15</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>2</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>31</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/qyzhizi title="Github → https://github.com/qyzhizi" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>Github</a></span>
<span class=links-of-social-item><a href=https://twitter.com/qyzhizi title="Twitter → https://twitter.com/qyzhizi" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-twitter fa-fw hvr-icon"></i>Twitter</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://lisenhui.cn title=https://lisenhui.cn target=_blank>凡梦星尘空间站</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate=2022-06-03T11:52:18+08:00></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=26077></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=62></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate=2023-07-03T19:21:43+08:00></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=goto-gtranslate class=button title=多语言翻译><i class="fas fa-globe"></i></div><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a>
<a href=https://github.com/qyzhizi rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script>
<script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=/pytorch-dataloader.html><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/2001_big_icons.png"><meta itemprop=name content="Hollis"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="Hollis"><meta itemprop=description content="share something"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="PyTorch DataLoader的工作机制"><meta itemprop=description content="PyTorch-DataLoader的工作机制"></span><header class=post-header><h1 class=post-title itemprop="name headline">PyTorch DataLoader的工作机制
<a href=https://github.com/qyzhizi/hugo-blog/tree/main/content/post/PyTorch-DataLoader%e7%9a%84%e5%b7%a5%e4%bd%9c%e6%9c%ba%e5%88%b6.md rel="noopener external nofollow noreferrer" target=_blank class="exturl post-edit-link" title=编辑><i class="fa fa-pen-nib"></i></a></h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-calendar"></i></span>
<span class=post-meta-item-text>发表于：</span>
<time title="发表于：2023-06-23 20:53:31 +0800 CST" itemprop="dateCreated datePublished" datetime="2023-06-23 20:53:31 +0800 CST">2023-06-23</time></span>
<span class=post-meta-item><span class=post-meta-item-icon><i class="far fa-folder-open"></i></span>
<span class=post-meta-item-text>分类于：</span>
<span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/programming itemprop=url rel=index><span itemprop=name>programming</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="far fa-file-word"></i></span>
<span class=post-meta-item-text>字数：</span><span>3072</span></span>
<span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="far fa-clock"></i></span>
<span class=post-meta-item-text>阅读：&ap;</span>
<span>7分钟</span></span>
<span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="far fa-eye"></i></span>
<span class=post-meta-item-text>浏览：</span>
<span class=waline-pageview-count data-path=/pytorch-dataloader.html><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><p>PyTorch-DataLoader的工作机制</p><ul><li><a href=#datasetsampler-%e4%b8%8e-dataloader%e7%9a%84%e5%85%b3%e7%b3%bb title="dataset、sampler 与 dataloader的关系？">dataset、sampler 与 dataloader的关系？</a></li><li><a href=#dataloaderpy-%e4%b8%bb%e8%bf%9b%e7%a8%8b%e4%b8%8e%e5%b7%a5%e4%bd%9c%e8%bf%9b%e7%a8%8b%e7%9a%84%e5%85%b3%e7%b3%bb title="dataloader.py 主进程与工作进程的关系？">dataloader.py 主进程与工作进程的关系？</a></li><li><a href=#%e6%95%b0%e6%8d%ae%e6%97%b6%e5%a6%82%e4%bd%95%e4%bb%8e%e8%bf%ad%e4%bb%a3%e5%99%a8dataloaderiter%e8%bf%94%e5%9b%9e%e7%9a%84 title=数据时如何从迭代器DataLoaderIter返回的？>数据时如何从迭代器DataLoaderIter返回的？</a></li><li><a href=#dataloaderpy%e4%b8%ad%e4%b8%bb%e8%bf%9b%e7%a8%8b%e5%92%8c%e5%b7%a5%e4%bd%9c%e8%bf%9b%e7%a8%8b%e6%98%af%e4%bd%95%e6%97%b6%e5%88%87%e6%8d%a2%e7%9a%84%e4%bc%9a%e5%8f%91%e7%94%9f%e6%ad%bb%e9%94%81%e5%90%97 title=dataloader.py中主进程和工作进程是何时切换的？会发生死锁吗？>dataloader.py中主进程和工作进程是何时切换的？会发生死锁吗？</a></li></ul><p>阅读前提：</p><ul><li>了解 pytorch dataloader 的基本用法</li></ul><p>最近调试代码时，遇到了PyTorch多进程加载数据的问题，在windows中遇到多进程启动失败的问题，问题连接：https://pytorch.org/docs/stable/notes/windows.html#multiprocessing-error-without-if-clause-protection 然后在github的issue 找到了解决办法：在<code>if __name__ == '__main__':</code>中去启动dataloader的迭代，这样可以避免启动子进程时windows系统又去启动dataloader的迭代。虽然问题解决了，但是我比较好奇，DataLoader多进程加载数据的机制。</p><p>为了学习DataLoader的机制，最好是看它的源码，而且看最早期的源码，因为比较简单，但核心思想是一致的。因此我看了PyTorch v0.1.4 版本的源码，比现在最新版本的源码简单多了。看完之后总算对多进程加载数据有了更清楚的理解，也理解了其中进程之间队列的死锁问题及其处理方法。</p><p>代码：
github v0.1.4 版本的 dataloader.py</p><p><a href=https://github.com/pytorch/pytorch/blob/v0.1.4/torch/utils/data/dataloader.py title=https://github.com/pytorch/pytorch/blob/v0.1.4/torch/utils/data/dataloader.py rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://github.com/pytorch/pytorch/blob/v0.1.4/torch/utils/data/dataloader.py
<i class="fa fa-external-link-alt"></i></a>
<a href=https://github.com/pytorch/pytorch/blob/v0.1.4/torch/utils/data/dataset.py title=https://github.com/pytorch/pytorch/blob/v0.1.4/torch/utils/data/dataset.py rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://github.com/pytorch/pytorch/blob/v0.1.4/torch/utils/data/dataset.py
<i class="fa fa-external-link-alt"></i></a>
<a href=https://github.com/pytorch/pytorch/blob/v0.1.4/torch/utils/data/sampler.py title=https://github.com/pytorch/pytorch/blob/v0.1.4/torch/utils/data/sampler.py rel="noopener external nofollow noreferrer" target=_blank class=exturl>https://github.com/pytorch/pytorch/blob/v0.1.4/torch/utils/data/sampler.py
<i class="fa fa-external-link-alt"></i></a></p><h2 id=datasetsampler-与-dataloader的关系>dataset、sampler 与 dataloader的关系？</h2><p><code>dataset</code> 提供索引的数据
<code>sampler</code> 提供如何返回<code>dataset</code>的<code>index</code>,比如：顺序与随机
<code>dataloader</code> 提供一个<code>batch</code>的数据，并通过多进程的方式返回数据。它可以通过<code>sampler</code> 构造一个<code>batch index</code> ,然后利用多进程、队列的方法调用<code>dataset</code>的方法来返回一个<code>batch</code>的数据。</p><p>dataset源码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Dataset</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __getitem__(self, index):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>NotImplementedError</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __len__(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>NotImplementedError</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TensorDataset</span>(Dataset):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, data_tensor, target_tensor):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>assert</span> data_tensor<span style=color:#f92672>.</span>size(<span style=color:#ae81ff>0</span>) <span style=color:#f92672>==</span> target_tensor<span style=color:#f92672>.</span>size(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>data_tensor <span style=color:#f92672>=</span> data_tensor
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>target_tensor <span style=color:#f92672>=</span> target_tensor
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>data_tensor<span style=color:#f92672>.</span>dim() <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>data_tensor <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>data_tensor<span style=color:#f92672>.</span>view(<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>target_tensor<span style=color:#f92672>.</span>dim() <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>target_tensor <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>target_tensor<span style=color:#f92672>.</span>view(<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __getitem__(self, index):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>data_tensor[index], self<span style=color:#f92672>.</span>target_tensor[index]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __len__(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>data_tensor<span style=color:#f92672>.</span>size(<span style=color:#ae81ff>0</span>)
</span></span></code></pre></div><p>sampler 源码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Sampler</span>(object):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, data_source):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __iter__(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>NotImplementedError</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __len__(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>NotImplementedError</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SequentialSampler</span>(Sampler):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, data_source):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>num_samples <span style=color:#f92672>=</span> len(data_source)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __iter__(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> iter(range(self<span style=color:#f92672>.</span>num_samples))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __len__(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>num_samples
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>RandomSampler</span>(Sampler):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, data_source):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>num_samples <span style=color:#f92672>=</span> len(data_source)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __iter__(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> iter(torch<span style=color:#f92672>.</span>randperm(self<span style=color:#f92672>.</span>num_samples)<span style=color:#f92672>.</span>long())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __len__(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> self<span style=color:#f92672>.</span>num_samples
</span></span></code></pre></div><p>dataloader 源码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DataLoader</span>(object):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Data loader. Combines a dataset and a sampler, and provides
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    single- or multi-process iterators over the dataset.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, dataset, batch_size<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>, shuffle<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>,
</span></span><span style=display:flex><span>                 sampler<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>, num_workers<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>, collate_fn<span style=color:#f92672>=</span>default_collate):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>dataset     <span style=color:#f92672>=</span> dataset
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>batch_size  <span style=color:#f92672>=</span> batch_size
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>num_workers <span style=color:#f92672>=</span> num_workers
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>collate_fn  <span style=color:#f92672>=</span> collate_fn
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> sampler <span style=color:#f92672>is</span> <span style=color:#f92672>not</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sampler <span style=color:#f92672>=</span> sampler
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> shuffle:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sampler <span style=color:#f92672>=</span> RandomSampler(dataset)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> <span style=color:#f92672>not</span> shuffle:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sampler <span style=color:#f92672>=</span> SequentialSampler(dataset)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __iter__(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> DataLoaderIter(self)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __len__(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> len(self<span style=color:#f92672>.</span>sampler)
</span></span></code></pre></div><h2 id=dataloaderpy-主进程与工作进程的关系>dataloader.py 主进程与工作进程的关系？</h2><p>DataLoader 类：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DataLoader</span>(object):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Data loader. Combines a dataset and a sampler, and provides
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    single- or multi-process iterators over the dataset.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, dataset, batch_size<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>, shuffle<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>,
</span></span><span style=display:flex><span>                 sampler<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>, num_workers<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>, collate_fn<span style=color:#f92672>=</span>default_collate):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>dataset     <span style=color:#f92672>=</span> dataset
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>batch_size  <span style=color:#f92672>=</span> batch_size
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>num_workers <span style=color:#f92672>=</span> num_workers
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>collate_fn  <span style=color:#f92672>=</span> collate_fn
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> sampler <span style=color:#f92672>is</span> <span style=color:#f92672>not</span> <span style=color:#66d9ef>None</span>:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sampler <span style=color:#f92672>=</span> sampler
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> shuffle:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sampler <span style=color:#f92672>=</span> RandomSampler(dataset)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> <span style=color:#f92672>not</span> shuffle:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>sampler <span style=color:#f92672>=</span> SequentialSampler(dataset)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __iter__(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> DataLoaderIter(self)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __len__(self):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> len(self<span style=color:#f92672>.</span>sampler)
</span></span></code></pre></div><p>DataLoader 类中定义了<code>__iter__</code>， <code>__iter__</code> 是一个特殊方法（special method），用于定义一个可迭代对象（iterable）。可迭代对象是指实现了 <code>__iter__</code> 方法的对象，该方法返回一个迭代器（iterator）。
这个迭代器是：<code>DataLoaderIter</code>，它<code>__init__</code>方法中定义了两个队列，用于进程之间的通信，如下所示：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DataLoaderIter</span>(object):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Iterates once over the DataLoader&#39;s dataset, as specified by the sampler&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># loader 是 DataLoader  的实例</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> __init__(self, loader):
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>dataset <span style=color:#f92672>=</span> loader<span style=color:#f92672>.</span>dataset
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>batch_size <span style=color:#f92672>=</span> loader<span style=color:#f92672>.</span>batch_size
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>collate_fn <span style=color:#f92672>=</span> loader<span style=color:#f92672>.</span>collate_fn
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>sampler <span style=color:#f92672>=</span> loader<span style=color:#f92672>.</span>sampler
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>num_workers <span style=color:#f92672>=</span> loader<span style=color:#f92672>.</span>num_workers
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>samples_remaining <span style=color:#f92672>=</span> len(self<span style=color:#f92672>.</span>sampler)
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>sample_iter <span style=color:#f92672>=</span> iter(self<span style=color:#f92672>.</span>sampler)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>num_workers:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>index_queue <span style=color:#f92672>=</span> multiprocessing<span style=color:#f92672>.</span>Queue()
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>data_queue <span style=color:#f92672>=</span> multiprocessing<span style=color:#f92672>.</span>Queue()
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>batches_outstanding <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>joined <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>workers <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>                multiprocessing<span style=color:#f92672>.</span>Process(
</span></span><span style=display:flex><span>                    target<span style=color:#f92672>=</span>_workerLoop,
</span></span><span style=display:flex><span>                    args<span style=color:#f92672>=</span>(self<span style=color:#f92672>.</span>dataset, self<span style=color:#f92672>.</span>index_queue, self<span style=color:#f92672>.</span>data_queue, self<span style=color:#f92672>.</span>collate_fn))
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(self<span style=color:#f92672>.</span>num_workers)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> w <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>workers:
</span></span><span style=display:flex><span>                w<span style=color:#f92672>.</span>daemon <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span> <span style=color:#75715e># ensure that the worker exits on process exit</span>
</span></span><span style=display:flex><span>                w<span style=color:#f92672>.</span>start()
</span></span><span style=display:flex><span>                <span style=color:#75715e># prime the prefetch loop with exactly 1 batch per process</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e># this ensures no deadlocks on the queues using the blocking queue API</span>
</span></span><span style=display:flex><span>                self<span style=color:#f92672>.</span>_putBatch()
</span></span></code></pre></div><p>其中<code>self.index_queue</code> 表示一个<code>batch</code>的索引，数据的填入由主进程完成，工作进程会从<code>self.index_queue</code>队列中获取数据，然后将一个批量的数据放入另外一个队列：<code>self.data_queue</code>
然后又<code>next</code>函数返回给迭代器的调用者。</p><h2 id=数据时如何从迭代器dataloaderiter返回的>数据时如何从迭代器DataLoaderIter返回的？</h2><p>迭代器DataLoaderIter 中定义了<code>__next__</code>方法：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>next</span>(self):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>num_workers:
</span></span><span style=display:flex><span>        <span style=color:#75715e># multi-process loading</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>batches_outstanding:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>assert</span>(<span style=color:#f92672>not</span> self<span style=color:#f92672>.</span>joined)
</span></span><span style=display:flex><span>            <span style=color:#75715e># maintain at most len(workers)+1 outstanding batches</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># to avoid deadlocks in the queues, using the blocking queue API</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># TODO: add and use non-blocking queue API</span>
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>_putBatch()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>assert</span>(self<span style=color:#f92672>.</span>batches_outstanding <span style=color:#f92672>&lt;=</span> len(self<span style=color:#f92672>.</span>workers) <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>batches_outstanding <span style=color:#f92672>-=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>            data <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>data_queue<span style=color:#f92672>.</span>get()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> isinstance(data, ExceptionWrapper):
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>raise</span> data<span style=color:#f92672>.</span>exc_type(data<span style=color:#f92672>.</span>exc_msg)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> data
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            self<span style=color:#f92672>.</span>_joinWorkers()
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>StopIteration</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e># single-process loading</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> self<span style=color:#f92672>.</span>samples_remaining:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> _processBatch(self<span style=color:#f92672>.</span>dataset, self<span style=color:#f92672>.</span>_nextBatch(), self<span style=color:#f92672>.</span>collate_fn)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>StopIteration</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>__next__ <span style=color:#f92672>=</span> next
</span></span></code></pre></div><p>当<code>dataloader</code>开启多进程时，<code>self.num_workers</code> 表示进程的数量，<code>self.batches_outstanding</code>记录
<code>self.index_queue</code> batch index 的数量，然后先执行<code>self._putBatch()</code>往<code>self.index_queue</code>添加一个batch&rsquo;s index ,然后执行<code>data = self.data_queue.get()</code>来获取一个batch的数据，然后返回data, 这就完成一个迭代过程。</p><h2 id=dataloaderpy中主进程和工作进程是何时切换的会发生死锁吗>dataloader.py中主进程和工作进程是何时切换的？会发生死锁吗？</h2><p>PyTorch 中的多进程数据加载机制使用了阻塞式队列（blocking queue）来进行进程间通信。阻塞式队列在队列为空或队列已满时会自动阻塞，直到有新的数据可用或队列中有空余空间为止。但是当工作进程A想要从空队列中取数据时，它首先会获得队列加锁，其他进程暂时无法访问队列。但是工作进程A由于取不到数据，也会被阻塞。这时候操作系统切换到主进程后，依然可以向空队列发送数据，因为工作进程A已经阻塞了。</p><p>具体解释是：
在阻塞式队列中，如果一个进程A想要从空队列（阻塞式队列）中获取数据，它会被自动阻塞，并等待队列中有新的数据可用。如果队列中一直没有数据，那么进程A会被阻塞并挂起。在这种情况下，工作进程A通常会释放对队列的锁，允许其他进程访问该队列。这是因为阻塞式队列的设计目的之一就是允许多个生产者和消费者并发地访问队列。</p><p>其它工作进程在空队列上等待，如果主进程取得cpu控制权，此时，由于工作队列已经释放了锁，主进程可以成功向队列中发送数据，并且有数据可用，它可以向队列中发送数据。后来当工作进程会被唤醒时，就可以获取到数据，并继续执行后续操作。</p><p>需要注意的是，当多个进程同时访问同一个队列时，可能会出现一些竞争条件和锁竞争的情况。这时候就需要使用线程安全的队列（如 queue.Queue）或者进程安全的队列（如 multiprocessing.Queue）来保证多个进程之间的数据交换安全可靠。此外，为了避免死锁和竞争条件等问题，还需要合理地设置队列的容量和缓冲策略。</p><p>启动多进程的过程：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>for</span> w <span style=color:#f92672>in</span> self<span style=color:#f92672>.</span>workers:
</span></span><span style=display:flex><span>    w<span style=color:#f92672>.</span>daemon <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span> <span style=color:#75715e># ensure that the worker exits on process exit</span>
</span></span><span style=display:flex><span>    w<span style=color:#f92672>.</span>start()
</span></span><span style=display:flex><span>    <span style=color:#75715e># prime the prefetch loop with exactly 1 batch per process</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># this ensures no deadlocks on the queues using the blocking queue API</span>
</span></span><span style=display:flex><span>    self<span style=color:#f92672>.</span>_putBatch()
</span></span></code></pre></div><p><code>w.daemon = True</code> ： 将工作进程A放入后台
<code>w.start()</code> ：启动工作进程A
<code>self._putBatch()</code> ：向 <code>self.index_queue</code> 发送一个批量的索引，免得在主进程执行<code>next </code>函数时发送死锁。</p><p>当启动工作进程A后，就算主进程没来得及向执行<code>self._putBatch()</code>也没关系，因为工作进程A由于获取不到数据最后会被挂起，并且工作进程A通常会释放对队列的锁。那么切换到主进程后可以继续执行<code>self._putBatch()</code>，最后在主进程调用<code>next()</code>函数从队列（<code>self.data_queue</code>）中拿数据时能拿到数据，因为工作进程由于之前的<code>self._putBatch()</code>函数会往队列<code>self.index_queue</code>发送了数据，然后工作队列会根据<code>self.index_queue</code>的数据往队列（<code>self.data_queue</code>）发送数据，所有下一次主进程向队列（<code>self.data_queue</code>）中拿数据时，可以保证拿到数据，不会造成死锁的局面。</p><p>这种死锁的局面就是：主进程向空队列（<code>self.data_queue</code>）拿数据，但是由于是空队列，于是阻塞挂起了
而工作进程也在向空队列（<code>self.index_queue</code>）拿数据，但是由于是空队列，于是阻塞也挂起了。于是都挂起了，但是<code>self.index_queue</code>需要主进程往其中填数据，才能保证工作往队列（<code>self.data_queue</code>）填数据。这样这两个进程互相死锁了。</p><p>为了避免这种死锁的情况，在主进程向空队列（<code>self.data_queue</code>）拿数据前要先执行<code>self._putBatch()</code></p></div><footer class=post-footer><div class=post-tags><a href=/tags/%e8%bf%9b%e7%a8%8b>进程</a>
<a href=/tags/pytorch>pytorch</a>
<a href=/tags/%e6%ad%bb%e9%94%81>死锁</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=reward-container><div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div><button>赞赏</button><div class=post-reward></div></div><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right><ul><li class=post-copyright-title><strong>文章标题：</strong>
PyTorch DataLoader的工作机制</li><li class=post-copyright-author><strong>原文作者：</strong>
Hollis</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=/pytorch-dataloader.html title="PyTorch DataLoader的工作机制">/pytorch-dataloader.html</a></li><li class=post-copyright-license><strong>版权声明：</strong>
本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=followme><span>欢迎关注我的其它发布渠道</span><div class=social-list><div class=social-item><a target=_blank class=social-link href=/images/wechat_channel.jpg><span class=icon><i class="fab fa-weixin"></i></span>
<span class=label>WeChat</span></a></div><div class=social-item><a target=_blank class=social-link href=/rss.xml><span class=icon><i class="fa fa-rss"></i></span>
<span class=label>RSS</span></a></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/opencv-canny-source-code-analysis.html rel=next title="Opencv Canny 源码解析"><i class="fa fa-chevron-left"></i> Opencv Canny 源码解析</a></div><div class="post-nav-prev post-nav-item"><a href=/pytorch-Edge-detection-using-convolution.html rel=prev title=Pytorch卷积实现边缘检测>Pytorch卷积实现边缘检测
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div id=gtranslate class=google-translate><i class="fa fa-language"></i><div id=google_translate_element></div></div><div class=copyright>&copy;
<span itemprop=copyrightYear>2010 - 2023</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=author itemprop=copyrightHolder>Hollis</span></div></div></footer><script type=text/javascript src=https://cdn.staticfile.org/animejs/3.2.1/anime.min.js defer></script>
<script type=text/javascript src=https://cdn.staticfile.org/viewerjs/1.11.0/viewer.min.js defer></script>
<script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":true,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"statis":{"enable":true,"plugin":"busuanzi"},"vendor":{"plugins":"qiniu","router":"https://cdn.staticfile.org"},"version":"4.4.1","waline":{"cfg":{"comment":true,"emoji":false,"imguploader":false,"pageview":true,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":"https://walinejs.comment.lithub.cc","sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"waline","file":"dist/waline.css","name":"@waline/client","version":"2.13.0"},"js":{"alias":"waline","file":"dist/waline.js","name":"@waline/client","version":"2.13.0"}}}</script><script type=text/javascript src=/js/main.min.37028fbafbd97fd89808b4c7b5a3a81f01ed0ab24001d273d774f9546a0e9170.js defer></script></body></html>